<!DOCTYPE html>
<html>
<head>
    <title>KEETOOL EDITOR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">
        body, html {
            overflow: hidden;
            height: 95vh;
        }

        div.keetool_editor_content {
            font-family: Arial, Helvetica, sans-serif;
            color: #000;
            width: 100%;
            height: 100%;
            -webkit-overflow-scrolling: touch;
            overflow: auto;
        }

        video {
            width: 99%;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        img {
            width: 99%;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        [contenteditable=true]:empty:before {
            content: attr(placeholder);
        }

        [contenteditable]:focus {
            outline: 0px solid transparent;
        }


    </style>
</head>

<body id="body-content">
<div id="keetool_editor_content" class="keetool_editor_content" contenteditable="true"
     placeholder="Enter text here..."
></div>
</body>
<script>

    var sel;

    function insertImage(url) {
        var html = '<div><img src="' + url + '"></div>';
        pasteHtmlAtCaret(html);
    }

    function insertVideo(url) {
        var html = '<video controls>' +
            ' <source src="' + url + '" type="video/mp4">' +
            '</video>';
        pasteHtmlAtCaret(html);
    }

    function pasteHtmlAtCaret(html) {
        document.getElementById('keetool_editor_content').focus();
        var range;
        sel = window.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
            range = sel.getRangeAt(0);
            range.deleteContents();

            var el = document.createElement("div");
            el.innerHTML = html;
            var frag = document.createDocumentFragment(), node, lastNode;
            var i = 1;
            while ((node = el.firstChild)) {
                lastNode = frag.appendChild(node);
                i++;
            }
            console.log(i);
            range.insertNode(frag);
            console.log(range);

            if (lastNode) {
                range = range.cloneRange();
                range.setStartAfter(lastNode);
                range.collapse(true);
                sel.removeAllRanges();
                sel.addRange(range);
            }
        }
    }

    // resetHeight();

    function resetHeight() {
        console.log('dsa');
        document.getElementById("body-content").style.height = '80%';
    }

    function getCursorPosition() {
        // var range, sel = window.getSelection();
        // if (sel.getRangeAt && sel.rangeCount) {
        //     range = sel.getRangeAt(0);
        //     console.log(range);
        // }
        // document.getElementById('keetool_editor_content').focus();
        // console.log(getInputSelection(document.getElementById('keetool_editor_content')))
    }

    function getInputSelection(el) {
        var start = 0, end = 0, normalizedValue, range,
            textInputRange, len, endRange;

        if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
            start = el.selectionStart;
            end = el.selectionEnd;
        } else {
            range = document.createRange();

            if (range && range.parentElement() == el) {
                len = el.value.length;
                normalizedValue = el.value.replace(/\r\n/g, "\n");

                // Create a working TextRange that lives only in the input
                textInputRange = el.createTextRange();
                textInputRange.moveToBookmark(range.getBookmark());

                // Check if the start and end of the selection are at the very end
                // of the input, since moveStart/moveEnd doesn't return what we want
                // in those cases
                endRange = el.createTextRange();
                endRange.collapse(false);

                if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                    start = end = len;
                } else {
                    start = -textInputRange.moveStart("character", -len);
                    start += normalizedValue.slice(0, start).split("\n").length - 1;

                    if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                        end = len;
                    } else {
                        end = -textInputRange.moveEnd("character", -len);
                        end += normalizedValue.slice(0, end).split("\n").length - 1;
                    }
                }
            }
        }

        return {
            start: start,
            end: end
        };
    }
</script>
</html>
